<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Four Hands Croupier</title>
  <style>
    :root { --bg:#0b0f13; --panel:#141a22; --accent:#ffd166; --text:#e8ecf1; }
    html,body{height:100%; margin:0; background:var(--bg); color:var(--text); font:16px/1.4 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:1100px; margin:24px auto; padding:16px;}
    .game{display:grid; grid-template-columns: 1fr 320px; gap:16px; align-items:start}

    /* Fixed-size stage at native pixels; base.png is ALWAYS visible */
    .stage{position:relative; border-radius:12px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.35);
      width:1152px; height:768px; background:#000;}
    .stage img{position:absolute; inset:0; width:100%; height:100%; display:block; object-fit:contain; user-select:none; -webkit-user-drag:none}
    #overlayImg{display:none; z-index:2; pointer-events:none}
    #baseImg{z-index:1}

    /* 4 invisible hit zones in a 2x2 grid */
    .zones{position:absolute; inset:0; z-index:3; display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr}
    .zones button{background:transparent; border:0; padding:0; margin:0; width:100%; height:100%; cursor:default}
    .zones button.armed{cursor:pointer}

    .panel{background:var(--panel); border-radius:12px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.35); position:sticky; top:16px}
    .row{display:flex; gap:8px; align-items:center; margin:10px 0}
    input[type=number]{flex:1; padding:10px 12px; border-radius:10px; border:1px solid #2a3441; background:#0f141b; color:var(--text)}
    button{padding:10px 14px; border-radius:10px; border:1px solid #2a3441; background:#19212c; color:var(--text); cursor:pointer}
    button.primary{background:#243142; border-color:#2e3c4f}
    .stats{display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:6px}
    .card{background:#0f141b;border:1px solid #293241; border-radius:10px; padding:10px}
    .status{margin-top:10px; min-height:24px; color:var(--accent)}
    .hint{opacity:.7; font-size:.9rem}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Four Hands Croupier</h1>
    <div class="game">
      <div class="stage" id="stage">
        <img id="baseImg" alt="croupier">
        <img id="overlayImg" alt="overlay">
        <div class="zones" id="zones" aria-label="pick a hand">
          <button data-pick="ul" aria-label="upper-left"></button>
          <button data-pick="ur" aria-label="upper-right"></button>
          <button data-pick="ll" aria-label="lower-left"></button>
          <button data-pick="lr" aria-label="lower-right"></button>
        </div>
      </div>
      <div class="panel">
        <div class="row">
          <input id="bet" type="number" min="1" step="1" placeholder="Enter bet (gold)" />
          <button id="go" class="primary">Go</button>
        </div>
        <div class="row">
          <button id="start">Start Game</button>
          <button id="cash">Cash Out</button>
        </div>
        <div class="stats">
          <div class="card"><strong>Total Wagers</strong><br><span id="wagers">0</span> gold</div>
          <div class="card"><strong>Total Winnings</strong><br><span id="winnings">0</span> gold</div>
        </div>
        <div class="status" id="status">Click <em>Start Game</em> to begin.</div>
        <div class="hint">Enter a bet, press <b>Go</b>, then click one of the dealer's four hands.</div>
      </div>
    </div>
  </div>

  <audio id="sWin" src="assets/win.wav" preload="auto"></audio>
  <audio id="sLose" src="assets/lose.wav" preload="auto"></audio>

  <script>
  (function(){
    // GitHub Pages: use RELATIVE paths (no leading slash)
    const ASSETS = 'assets/';
    const SRC = {
      base: ASSETS + 'base.png',
      ul:   ASSETS + 'ul.png',
      ll:   ASSETS + 'll.png',
      ur:   ASSETS + 'ur.png',
      lr:   ASSETS + 'lr.png'
    };

    const baseImg = document.getElementById('baseImg');
    const ovImg   = document.getElementById('overlayImg');
    const zones   = document.getElementById('zones');

    const betEl   = document.getElementById('bet');
    const goBtn   = document.getElementById('go');
    const startBtn= document.getElementById('start');
    const cashBtn = document.getElementById('cash');
    const status  = document.getElementById('status');
    const sWin    = document.getElementById('sWin');
    const sLose   = document.getElementById('sLose');

    const overlayByPick = { ul:SRC.ul, ur:SRC.ur, ll:SRC.ll, lr:SRC.lr };

    let totalWagers = 0, totalWinnings = 0;
    let armed = false, roundActive = false, winningPick = null;

    const fmt = n => new Intl.NumberFormat().format(n|0);
    const updateStats = () => {
      document.getElementById('wagers').textContent = fmt(totalWagers);
      document.getElementById('winnings').textContent = fmt(totalWinnings);
    };

    const chooseRandomPick = () => ['ul','ur','ll','lr'][Math.floor(Math.random()*4)];

    function startRound(){
      ovImg.style.display='none'; ovImg.src='';
      armed=false; setArmedCursor(false); roundActive=true;
      winningPick = chooseRandomPick();
      status.textContent = 'New round. Place your bet and press Go.';
    }

    function armBet(){
      const amt = Math.max(1, Math.floor(Number(betEl.value)));
      if(!roundActive){ status.textContent = 'Press Start Game first.'; return; }
      if(!amt){ status.textContent = 'Enter a valid bet.'; return; }
      betEl.value = amt; armed = true; setArmedCursor(true);
      status.textContent = 'Bet armed. Choose a hand.';
    }

    function setArmedCursor(on){
      [...zones.querySelectorAll('button')].forEach(b=> b.classList.toggle('armed', on));
    }

    function onPick(e){
      const btn = e.target.closest('button[data-pick]');
      if(!btn) return;
      if(!roundActive){ status.textContent='Press Start Game.'; return; }
      if(!armed){ status.textContent='Enter bet and press Go.'; return; }
      const picked = btn.getAttribute('data-pick');

      // Show overlay corresponding to the clicked quadrant
      ovImg.src = overlayByPick[picked];
      ovImg.style.display = 'block';

      const bet = Math.max(1, Math.floor(Number(betEl.value)));
      totalWagers += bet;
      if(picked === winningPick){
        const payout = bet*4; totalWinnings += payout; try{ sWin.currentTime=0; sWin.play(); }catch(e){}
        status.textContent = `You picked ${picked.toUpperCase()} and WIN! (+${payout} gold)`;
      } else {
        try{ sLose.currentTime=0; sLose.play(); }catch(e){}
        status.textContent = `You picked ${picked.toUpperCase()} and lose. (-${bet} gold)`;
      }
      armed=false; setArmedCursor(false); updateStats();
    }

    function cashOut(){
      const net = totalWinnings - totalWagers;
      alert(`You cash out with ${fmt(net)} gold (winnings: ${fmt(totalWinnings)} âˆ’ wagers: ${fmt(totalWagers)}).

Update your character sheet accordingly.`);
    }

    // Boot: load base image, fix stage size, and SHOW base
    const i = new Image();
    i.onload = () => {
      document.getElementById('stage').style.width = i.naturalWidth + 'px';
      document.getElementById('stage').style.height = i.naturalHeight + 'px';
      baseImg.src = SRC.base; // show base underlay immediately
      baseImg.style.display = 'block';
      status.textContent = 'Loaded. Click Start Game to begin.';
      updateStats();
    };
    i.onerror = () => { status.textContent = 'Could not load assets/base.png (check path & case).'; };
    i.src = SRC.base;

    // Events
    zones.addEventListener('click', onPick);
    goBtn.addEventListener('click', armBet);
    startBtn.addEventListener('click', startRound);
    cashBtn.addEventListener('click', cashOut);
  })();
  </script>
</body>
</html>
